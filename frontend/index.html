<!doctype html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, interactive-widget=resizes-content" />
    <meta name="theme-color" content="#C7855E" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <title>MusicLovely — Músicas Personalizadas Profissionais</title>
    <meta name="description" content="Surpreenda alguém com uma música personalizada criada por profissionais. Qualidade de estúdio, entrega rápida e 100% original." />
    <meta name="author" content="MusicLovely" />
    
    <!-- Facebook Domain Verification -->
    <meta name="facebook-domain-verification" content="ietm0enn4ii3n3ird379eh0gzlia9x" />
    
    <!-- Open Graph (WhatsApp, Facebook, Telegram, iMessage) -->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="MusicLovely" />
    <meta property="og:title" content="MusicLovely — Músicas Personalizadas Profissionais" />
    <meta property="og:description" content="Surpreenda alguém com uma música personalizada criada por profissionais. Qualidade de estúdio, entrega rápida e 100% original." />
    <meta property="og:url" content="https://www.musiclovely.com/" />
    <meta property="og:image" content="https://www.musiclovely.com/og/musiclovely-og-1200x630.png" />
    <meta property="og:image:secure_url" content="https://www.musiclovely.com/og/musiclovely-og-1200x630.png" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="Music Lovely - Logo com coração e nota musical em laranja sobre fundo gradiente amarelo" />
    <meta property="og:locale" content="pt_BR" />
    <meta property="og:locale:alternate" content="en_US" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@musiclovely" />
    <meta name="twitter:creator" content="@musiclovely" />
    <meta name="twitter:title" content="MusicLovely — Músicas Personalizadas Profissionais" />
    <meta name="twitter:description" content="Crie uma música única para presentear. Produção profissional e artística." />
    <meta name="twitter:image" content="https://www.musiclovely.com/og/musiclovely-og-1200x630.png" />
    <meta name="twitter:image:alt" content="Music Lovely - Logo com coração e nota musical em laranja sobre fundo gradiente amarelo" />
    
    <link rel="canonical" href="https://www.musiclovely.com/" />
    
    <!-- ✅ OTIMIZAÇÃO: Preconnect para domínios críticos (antes de qualquer script) -->
    <link rel="preconnect" href="https://zagkvtxarndluusiluhb.supabase.co" crossorigin />
    <link rel="dns-prefetch" href="https://zagkvtxarndluusiluhb.supabase.co" />
    <link rel="dns-prefetch" href="https://cdn.utmify.com.br" />
    <!-- ✅ OTIMIZAÇÃO: Preload de recursos críticos acima da dobra -->
    <link rel="preload" as="image" href="/images/collage-memories-new.webp" fetchpriority="high" type="image/webp" />
  </head>

  <body>
    <div id="root">
      <div id="app-root"></div>
    </div>
    <!-- ✅ OTIMIZAÇÃO: Defer script principal para não bloquear render -->
    <script type="module" src="/src/main.tsx" defer></script>

    <!-- Pixel UTMify -->
    <script>
      // ✅ CORREÇÃO: Verificar produção pelo hostname (não depende de substituição de variáveis)
      const isProduction = 
        location.hostname === 'musiclovely.com' ||
        location.hostname === 'www.musiclovely.com' ||
        location.hostname === 'musiclovely.com.br' ||
        location.hostname === 'www.musiclovely.com.br' ||
        location.hostname.endsWith('.vercel.app');
      
      const shouldSkip =
        location.pathname.startsWith('/admin') ||
        location.pathname.startsWith('/app/admin');
      const isLocal =
        location.hostname === 'localhost' ||
        location.hostname === '127.0.0.1' ||
        location.hostname === '0.0.0.0';

      // ✅ SUPRIMIR LOGS: Interceptar console para filtrar logs dos scripts UTMify
      // Aplicar em produção e também em desenvolvimento para manter console limpo
      if (!isLocal || isProduction) {
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalInfo = console.info;
        const originalDebug = console.debug;
        
        // Filtros para logs que devem ser suprimidos
        const shouldSuppress = (args) => {
          // Verificar todos os argumentos, não apenas o primeiro
          const message = String(args[0] || '');
          const secondArg = args[1];
          
          // Suprimir logs específicos dos pixels UTMify
          const pixelPatterns = [
            'buttons',
            'response for',
            '[Meta Pixel]',
            '[TikTok Pixel]',
            'Missing \'content_id\'',
            'Removed parameters from custom data',
            'pixel.js',
            'pixel-tiktok.js',
            'fbevents.js'
          ];
          
          // Verificar se a mensagem contém algum padrão
          if (pixelPatterns.some(pattern => message.includes(pattern))) {
            return true;
          }
          
          // Verificar se o segundo argumento é um array de botões (logs do pixel)
          if (Array.isArray(secondArg) && secondArg.length > 0) {
            const firstItem = secondArg[0];
            // Se for um elemento HTML button, provavelmente é log do pixel
            if (firstItem && typeof firstItem === 'object' && firstItem.tagName === 'BUTTON') {
              return true;
            }
          }
          
          // Verificar se a mensagem é apenas "buttons" ou "buttons Array"
          if (message.trim() === 'buttons' || message.trim().startsWith('buttons ')) {
            return true;
          }
          
          return false;
        };
        
        console.log = function(...args) {
          if (!shouldSuppress(args)) {
            originalLog.apply(console, args);
          }
        };
        
        console.warn = function(...args) {
          if (!shouldSuppress(args)) {
            originalWarn.apply(console, args);
          }
        };
        
        console.info = function(...args) {
          if (!shouldSuppress(args)) {
            originalInfo.apply(console, args);
          }
        };
        
        console.debug = function(...args) {
          if (!shouldSuppress(args)) {
            originalDebug.apply(console, args);
          }
        };
      }

      // ✅ CORREÇÃO: Carregar UTMify em produção OU em desenvolvimento (para testes)
      // Em desenvolvimento, ainda carregar para testar o tracking
      if (!shouldSkip && (isProduction || !isLocal)) {
        const loadPixels = () => {
          window.pixelId = "68f98a3f196fbe7f0e5683c7";
          window.tikTokPixelId = "693c50472e9b1020b6ac57d4";

          const scripts = [
            "https://cdn.utmify.com.br/scripts/pixel/pixel.js",
            "https://cdn.utmify.com.br/scripts/pixel/pixel-tiktok.js",
          ];

          for (const src of scripts) {
            const el = document.createElement("script");
            el.async = true;
            el.src = src;
            document.head.appendChild(el);
          }

          const utms = document.createElement("script");
          utms.async = true;
          utms.src = "https://cdn.utmify.com.br/scripts/utms/latest.js";
          utms.setAttribute("data-utmify-prevent-xcod-sck", "");
          utms.setAttribute("data-utmify-prevent-subids", "");
          utms.onload = () => {
            // Disparar evento customizado quando UTMify estiver pronto
            window.dispatchEvent(new CustomEvent('utmify:ready', { bubbles: true }));
          };
          document.head.appendChild(utms);
        };

        // ✅ OTIMIZAÇÃO: Adiar carregamento dos pixels até depois do FCP
        // Usar requestIdleCallback com timeout menor para não bloquear interação
        if ('requestIdleCallback' in window) {
          window.requestIdleCallback(loadPixels, { timeout: 3000 });
        } else {
          // Fallback: aguardar load + delay adicional
          window.addEventListener(
            'load',
            () => {
              setTimeout(loadPixels, 2000);
            },
            { once: true }
          );
        }
      }
    </script>
  </body>
</html>
